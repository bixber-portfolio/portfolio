{% extends "base.html" %}
{% load custom_tags %}
{% load static %}

{% block title %}
  Профиль пользователя {{ data.user.get_first_last_name }}
{% endblock title %}

{% block content %}
{% if request.user != data.user %}
  <style>
    .card-link {
      display: none;
    }
    .history-lesson {
      display: none;
    }
  </style>
{% endif %}
<div class="container">
  <div class="row gy-4">
      <div class="col-lg-6">
        <div class="card card-profile rounded-4 shadow-sm">
          <div class="card-body d-flex">
            <div class="mb-0 pb-0">
              {% include 'includes/profiles/photo_image.html' with size_code="big" obj=data.profile %}
            </div>
            <div class="ms-3 d-flex flex-column justify-content-between w-100">
              <div>
                <h3 class="card-title mb-0">{{ data.user.first_name }} {{ data.user.last_name }}</h5>
                <p class="card-text text-role">{{data.user.get_role_display}}</p>
              </div>
              {% if data.user.role == "teacher" %}
                <p class="card-text text-edu-level mt-auto mb-0">{{data.profile.get_education_level_display}}</p>
              {% endif %}
              <p class="card-text text-age mt-auto">{{ data.user_age }} {{ data.user_age|custom_pluralize:"год,года,лет" }}</p>
              <a class="card-link btn btn-primary mb-0 mt-auto py-0 text" href="{% url 'profiles:user_edit' data.user.username %}">Редактировать пользователя</a>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="card card-profile card-profile-rate rounded-4 shadow-sm"
        style="background-image: url('{% if data.profile.rates.last %}{{ data.profile.rates.last.theme_image.url }}{% else %}{% static '' %}{% endif %}');">
        <div class="card-body d-flex flex-column justify-content-between align-items-center h-100">
          <h5 class="card-title mb-0">Тариф</h5>
          <p class="text-rate mb-auto mt-auto">{% if data.profile.rates.all %}{{ data.profile.rates.last.title|truncatechars:15 }}{% else %}Отсутствует{% endif %}</p>
          {% if data.user.role != "teacher" %}
            <a class="card-link btn btn-secondary mb-0 py-0 text w-100 text bg-secondary" href="{% url 'services:services_list' %}">{% if data.profile.rates.all %}Сменить{% else %}Установить{% endif %}</a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  <div class="row my-4">
    <div class="col">
      <div class="card card-profile card-profile-main rounded-4 shadow-sm">
        <h5 class="card-header text text-center fw-bold">Основная информация</h5>
        <div class="card-body d-flex flex-column">
          {% if data.profile.bio %}
            <div class="card-article-bio d-flex flex-column rounded-3 bg-warning bg-opacity-25 px-2 py-1 mb-3">
              <p class="article-title">О себе:</p>
              <p class="article-text" id="bio">{{ data.profile.bio|linebreaksbr }}</p>
            </div>
          {% endif %}
          <div class="card-article-main d-flex flex-column align-items-center rounded-3 bg-info bg-opacity-50 px-2 py-1 mb-3">
            <p class="article-title">Логин:</p>
            <p class="article-text" id="username">{{ data.user.username }}</p>
          </div>
          <div class="card-article d-flex flex-column flex-lg-row justify-content-between">
            {% include "includes/profiles/profile_data_line.html" with title="Адрес электронной почты:" data=data.user.email %}
            {% include "includes/profiles/profile_data_line.html" with title="Номер телефона:" data=data.user.phone_number %}
          </div>
          <div class="card-article d-flex flex-column flex-lg-row mt-2">
            {% with data.profile.gender_code as gender_code %}
              {% if gender_code %}
                {% include "includes/profiles/profile_data_line.html" with title="Пол:" data=data.profile.get_gender_code_display %}
              {% else %}
                {% include "includes/profiles/profile_data_line.html" with title="Пол:" data=data.profile.gender_code %}
              {% endif %}
            {% endwith %}
            {% include "includes/profiles/profile_data_line.html" with title="Дата рождения:" data=data.profile.birthday_date %}
          </div>
          <div class="card-article d-flex flex-column justify-content-between flex-lg-row mt-2">
            {% include "includes/profiles/profile_data_line.html" with title="Telegram:" data=data.profile.telegram_username %}
            {% include "includes/profiles/profile_data_line.html" with title="Подписка на рассылку:" data=data.user.is_news_sub is_have_parameter="true" %}
          </div>
          <a class="card-link btn btn-primary mt-3 text w-100 py-2" id="card-profile-main-button" href="{% url 'profiles:profile_edit' data.user.username %}">Редактировать данные профиля</a>
        </div>
      </div>
    </div>
  </div>
  {% include 'includes/lessons/lessons_history.html' with card_title="История завершенных занятий" %}
</div>
{% endblock content %}